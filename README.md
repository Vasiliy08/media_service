## Задача

Разработать REST API микросервис для приёма, обработки и управления медиафайлами. Микросервис должен уметь принимать файлы через HTTP-запросы, сохранять их на локальный диск и отправлять копию в облачное хранилище. Для каждого файла должен быть сгенерирован уникальный идентификатор (UID), который будет использоваться для дальнейшей работы с файлом. Кроме того, необходимо сохранять метаданные файла в базу данных, включая размер, формат, оригинальное название и расширение файла.

## Требования

- [x] Приём файлом: API должен поддерживать загрузку файлов через HTTP POST запросы. Файлы могут быть любого типа (например, изображения, видео, аудио).
- [x] Потоковый приём файлов: API должен поддерживать загрузку файлов через стрим. Файлы могут быть любого типа (например, изображения, видео, аудио).
- [x] Сохранение файлов на диск: После приёма файл должен сохраняться на сервере.
- [x] Отправка в облако: Копия файла должна быть асинхронно отправлена в облачное хранилище.
- [x] Генерация UID: Для каждого файла должен быть сгенерирован уникальный идентификатор.
- [x] Сохранение метаданных: Метаданные каждого файла должны быть сохранены в базе данных PostgreSQL через SQLAlchemy. Метаданные включают размер файла, формат, оригинальное название и расширение.

### Дополнительные требования

- [x] Крон для очистки локального диска: Реализовать крон задачу, которая будет регулярно очищать старые или неиспользуемые файлы с локального диска.
- [x] Ручка для получения файла по UID: Реализовать API-метод для получения файла по его уникальному идентификатору, с возможностью скачивания файла.

## Технологии

- [x] Используется FastAPI как фреймворк.
- [x] Используется SQLAlchemy как ORM.
- [x] Используется PostgreSQL.
- [x] Облачное хранилище: Использование условного API для демонстрации интеграции

## Инстукция

1. Наличие docker и docker-compose.
2. Наличие make (Опционально).


## Установка

 **Клонируйте репозиторий:**

   ```bash
   git clone https://github.com/Vasiliy08/media_service.git
   ```

## Запуск приложения с использованием Makefile

* `make start` - Запуск приложения.
* `make migrate` - Создание миграции для alembic (alembic revision --autogenerate).
* `make upgrade` - Апгрейд (alembic upgrade head)
* `make logs` - Просмотр логов.
* `make stop` - Остановка приложения с удалением вольюмов.
* `make test` - Запуск тестов.


## Запуск приложения без Makefile

Если вы не хотите использовать `Makefile`, вы можете выполнить те же команды вручную, используя `docker-compose`:

* `docker-compose -f docker_compose/storage.yaml -f docker_compose/app.yaml up --build -d` - Запуск приложения.
* `docker-compose -f docker_compose/storage.yaml -f docker_compose/app.yaml exec -it main-app alembic revision --autogenerate` - Создание миграции для alembic (alembic revision --autogenerate).
* `docker-compose -f docker_compose/storage.yaml -f docker_compose/app.yaml exec -it main-app alembic upgrade head` - Апгрейд (alembic upgrade head)
* `docker-compose -f docker_compose/storage.yaml -f docker_compose/app.yaml logs -f` - Просмотр логов.
* `docker-compose -f docker_compose/storage.yaml -f docker_compose/app.yaml down -v` - Остановка приложения.
* `docker-compose -f docker_compose/storage.yaml -f docker_compose/app.yaml exec -it main-app pytest` - Запуск тестов.


## API Документация

Документация API доступна по [адресу](http://127.0.0.1:8000/api/docs).
